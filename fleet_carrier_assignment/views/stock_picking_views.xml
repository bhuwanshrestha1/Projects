<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Add Assign Carrier Action in Tree View -->
    <record id="action_assign_carrier_tree" model="ir.actions.server">
        <field name="name">Assign Carrier</field>
        <field name="model_id" ref="stock.model_stock_picking"/>
        <field name="binding_model_id" ref="stock.model_stock_picking"/>
        <field name="binding_view_types">list</field>
        <field name="state">code</field>
        <field name="code">
if records:
    action = records.action_assign_carrier()
        </field>
    </record>

    <!-- Add Unassign Carrier Action in Tree View -->
    <record id="action_unassign_carrier_tree" model="ir.actions.server">
        <field name="name">Unassign Carrier</field>
        <field name="model_id" ref="stock.model_stock_picking"/>
        <field name="binding_model_id" ref="stock.model_stock_picking"/>
        <field name="binding_view_types">list</field>
        <field name="state">code</field>
        <field name="code">
if records:
    action = records.action_unassign_carrier()
        </field>
    </record>
    
     <!-- Add vehicle field to form view -->
    <record id="view_picking_form_inherit_fleet" model="ir.ui.view">
        <field name="name">stock.picking.form.fleet</field>
        <field name="model">stock.picking</field>
        <field name="inherit_id" ref="stock.view_picking_form"/>
        <field name="arch" type="xml">
            <!-- Add vehicle and weight fields -->
            <xpath expr="//field[@name='origin']" position="after">
                <field name="vehicle_id" 
                       options="{'no_create': True}"
                       readonly="1"/>
                <field name="assignment_id" 
                       readonly="1"/>
                <field name="total_weight"/>
                <field name="total_volume"/>
            </xpath>
        </field>
    </record>
    
    <!-- Add fields to tree view -->
    <record id="view_picking_tree_inherit_fleet" model="ir.ui.view">
        <field name="name">stock.picking.tree.fleet</field>
        <field name="model">stock.picking</field>
        <field name="inherit_id" ref="stock.vpicktree"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='name']" position="after">
                <field name="vehicle_id" optional="show"/>
                <field name="assignment_id" optional="hide"/>
                <field name="total_weight" optional="show"/>
                <field name="total_volume" optional="show"/>
            </xpath>
        </field>
    </record>
    
    <!-- Add filter for vehicle assignment -->
    <record id="view_picking_search_inherit_fleet" model="ir.ui.view">
        <field name="name">stock.picking.search.fleet</field>
        <field name="model">stock.picking</field>
        <field name="inherit_id" ref="stock.view_picking_internal_search"/>
        <field name="arch" type="xml">
            <xpath expr="//filter[@name='available']" position="after">
                <separator/>
                <filter string="With Vehicle" name="with_vehicle" domain="[('vehicle_id', '!=', False)]"/>
                <filter string="Without Vehicle" name="without_vehicle" domain="[('vehicle_id', '=', False)]"/>
            </xpath>
            <xpath expr="//group" position="inside">
                <filter string="Vehicle" name="group_vehicle" context="{'group_by': 'vehicle_id'}"/>
                <filter string="Assignment" name="group_assignment" context="{'group_by': 'assignment_id'}"/>
            </xpath>
        </field>
    </record>
</odoo>